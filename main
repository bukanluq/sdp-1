// Define pin numbers for the LEDs, the buttons, and the motor
int led1 = D8; // Pin for LED 1
int led2 = D9; // Pin for LED 2
int button1 = D7; // Pin connected to the first push button
int button2 = D6; // Pin connected to the second push button
int motorPin1 = D0; // Input pin 1 for the motor
int motorPin2 = D1; // Input pin 2 for the motor

// Variable to track the current state of the LEDs
int state = 0;

void setup() {
  ledcSetup(0, 5000, 13); // 13-bit resolution
  ledcAttachPin(motorPin1, 0); // attach the channel to the GPIO to be controlled

  Serial.begin(115200); // Start serial communication at 115200 baud rate
  pinMode(led1, OUTPUT); // Set LED 1 as an output
  pinMode(led2, OUTPUT); // Set LED 2 as an output
  pinMode(button1, INPUT); // Set the first button pin as an input
  pinMode(button2, INPUT); // Set the second button pin as an input
}
 
void loop() {
  int buttonState1 = digitalRead(button1); // Read the state of the first button
  int buttonState2 = digitalRead(button2); // Read the state of the second button

  // Check if the first button is pressed
  if(buttonState1 == HIGH) {
    state = (state + 1) % 4; // Increment the state and wrap around after 3

    // Control LEDs based on the current state using an if-else statement
    if (state == 0) {
      digitalWrite(led1, LOW);  // LED 1 off
      digitalWrite(led2, LOW);  // LED 2 off
    } else if (state == 1) {
      digitalWrite(led1, HIGH); // LED 1 on
      digitalWrite(led2, LOW);  // LED 2 off
    } else if (state == 2) {
      digitalWrite(led1, LOW);  // LED 1 off
      digitalWrite(led2, HIGH); // LED 2 on
    } else if (state == 3) {
      digitalWrite(led1, HIGH); // LED 1 on
      digitalWrite(led2, HIGH); // LED 2 on
    }

    Serial.println("State changed to: " + String(state)); // Print state change to the serial monitor
    delay(500); // Debounce delay to avoid multiple rapid state changes

    // Wait until the button is released to avoid repeated state changes
    while(digitalRead(button1) == HIGH); 
  }

  // Check if the second button is pressed
  if(buttonState2 == HIGH) {
    // Control motor based on the current state using an if-else statement
    if (state == 0) {
      ledcWrite(0, 0); // Motor off
    } else if (state == 1) {
      ledcWrite(0, 3276); // Motor half speed (3276 is 1/2 of 6553)
    } else if (state == 2) {
      ledcWrite(0, 4919); // Motor 3/4 speed (4919 is 3/4 of 6553)
    } else if (state == 3) {
      ledcWrite(0, 6553); // Motor full speed (6553 is full of 6553)
    }
    delay(500); // Debounce delay to avoid multiple rapid state changes
    // Wait until the button is released to avoid repeated state changes
    while(digitalRead(button2) == HIGH);
  }
}
